<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <style>body{margin: 0;} canvas{position: absolute;display: block;filter: contrast(1.6);z-index: -1;}</style>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .load {
        position: fixed;
        z-index: 100;
        width: 100%;
        height: 100%;
        background-color: #d10000;
        opacity: 1;
        transition: opacity 1s ease-in-out;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      .loadstate {
        width: 65%;
        margin-top: 1rem;
        font-weight: bolder;
      }
     .loadinfo {
        color: white;
        font-size: 18px;
      }
      .loadstate .rangebox  {
        height: 16px;
        border: 3px solid white;
        margin-top: 5px;
        padding: 3px;
      }
     .loadstate .rangeblock {
        transition: width 0.5s ease-in-out;
        width: 0%;
        height: 100%;
        background-color: white;
      }
      .bugjump {
        width: 70%;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <section class="load"><img class="bugjump" src="bugjump.png"></img></section>
    <script>
      let fileLoaded = 0;
      const loadingDiv = document.querySelector('.load');
      function SNLB(i, range){//setNewLoadBlock
        const loadstate = document.createElement('div');
        loadstate.classList.add('loadstate');
        if (range){
          loadstate.innerHTML = '<h class="loadinfo"></h><div class="rangebox"><div class="rangeblock"></div></div>';
        }else{
          loadstate.innerHTML = '<h class="loadinfo"></h>';
        }
        loadstate.id = i;
        loadingDiv.appendChild(loadstate);
        const loadinfo = loadstate.querySelector('.loadinfo');
        const rangeblock = loadstate.querySelector('.rangeblock');
        return {loadstate, loadinfo, rangeblock}
      }
      function loadFile(url, type, range){
        const {loadstate, loadinfo, rangeblock} = SNLB(url, range);
        loadinfo.textContent = `Loading ${url}...`;
        const xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'text';
        xhr.onprogress = (e) => {
          if (e.lengthComputable) {
            const percentComplete = (e.loaded / e.total) * 100;
            rangeblock.style.width = `${percentComplete}%`;
          }
        }
        xhr.onload = () => {
          if (xhr.status === 200) {
            loadinfo.textContent = `${url} loaded successfully!`;
            switch (type) {
              case 'js':
                const script = document.createElement('script');  
                script.textContent = xhr.responseText;
                document.body.appendChild(script);
                break;
              case 'css':
                const style = document.createElement('link');
                style.textContent = xhr.responseText;
                style.rel = 'stylesheet';
                style.href = url;
                document.head.appendChild(style);            
            }
          }else{
            loadinfo.textContent = `Failed to load ${url}!`;
            rangeblock.style.width = '0%';
          }
        }
        xhr.onerror = () => {
          loadinfo.textContent = `Failed to load ${url}!`;
          rangeblock.style.width = '0%';
        }
        xhr.send();
      }
    </script>
    <script type="module">
      async function loadTHREE() {
        const {loadinfo, rangeblock} = SNLB('three', true);
        loadinfo.textContent = 'Loading the three@0.174.0.js module...';
        const module = await import('//unpkg.com/three@0.174.0/build/three.module.min.js');
        try {
          window.THREE = module;
          loadinfo.textContent = 'The three@0.174.0.js module is loaded successfully!';
          rangeblock.style.width = '100%';
          setTimeout(() => {
            loadMcPanorama();
          }, 500)
        }catch (e) {
          loadinfo.textContent = 'Failed to load the three.js module!';
          rangeblock.style.width = '0%';
        }
      }
      loadTHREE();
    </script>
    <audio id="Playmusic"></audio>
    <section>
      <main id="title" class="unselectable">
        <div style="position: relative;">
          <img class="logo" src="Global-Header_MCCB-Logo_300x51.svg" alt="logo"/>
          <span class="ooops"><a href="https://github.com/Domdkw/MC-Panorama">https://github.com/Domdkw/MC-Panorama</a></span>
        </div>
        <div class="btn-area">
          <div class="all">
            <button id="create" onclick="create()"><span class="goggles"></span>机械动力：思索</button>
            <button id="server" onclick="server(true)">服务器</button>
            <button id="options" onclick="options(true)">选项</button>
          </div>
          <div class="half">
            <button id="home_page" onclick="cd('\/\/www.prcooker.asia', null)">主页</button>
            <div class="sound_range_div">
              <div>            
                <span id="bg_music_text">音乐：</span>
                <span id="sound_state">off</span></di>
              </div>
              <input type="range" id="volume_slider" min="0" max="1" step="0.01" value="0">
            </div>
            <button id="lang_btn" title="language语言" onclick="showlang()"><img src="lang-ico.png" alt="lang-ico"></button>
          </div>
        </div>
      </main>
      <section id="lang-div" class="dirt unselectable">
        <span id="lang_title" class="detailed-title">选择语言</span>
        <hr class="lang-hr">
        <div class="language-list">
          <span id="lang-unknown">(unknown)</span>
          <span id="zh-CN">简体中文</span>
          <span id="zh-TW">繁體中文（中国台湾）</span>
          <span id="en-US">English</span>
        </div>
        <hr class="lang-hr">
        <div class="lang-btn-half">
          <button onclick="unicode()"><span id="Use_Unicode_fonts">使用Unicode字体：</span><span id="ttf-state">off</span></button>
          <button id="lang_done" onclick="hiddenlang()">完成</button>
        </div>
      </section>
      <section id="cd-page" class="dirt">
        <div class="cd-main">
          <div class="cd-title">
            <span id="cd_text_info">这指向一个网页链接，不能确定其安全性，是否进行跳转？</span>
            <a id="cd_text_link" style="color: #2530ff;"></a>
          </div>
          <div class="cd-buttons">
            <button id="openurl">打开此网站</button>
            <button id="urlcopy">复制到剪贴板</button>
            <button id="urlcancel" onclick="cd(false)">取消</button>
          </div>
        </div>
      </section>
      <section id="server-page" class="dirt">
        <div class="sv_title">服务器列表</div>
        <div class="sv-div">
          <div class="sv-list">
            <div class="sv-item" data-server-ip="play.simpfun.cn:19533">
              <img class="sv-title-img" src="/server/lyf 2024.43.43.png" alt="服务器图片">
              <div class="sv-item-info">
                <p style="font-size: large;">lyf 2024.43.43</p>
                <p class="sv-description" style="color: #eee8;"></p>
              </div>
              <div class="sv-item-state">
                <div class="sv-item-online">
                  <span class="player-state">
                  </span>
                  <div class="sv-state-img"></div>
                </div>
              </div>
            </div><!--card-->
            <div class="sv-item" data-server-ip="mc.catserver.moe">
              <img class="sv-title-img" src="" alt="服务器图片">
              <div class="sv-item-info">
                <p style="font-size: large;">神必猫猫</p>
                <p class="sv-description" style="color: #eee8;"></p>
              </div>
              <div class="sv-item-state">
                <div class="sv-item-online">
                  <span class="player-state">
                  </span>
                  <div class="sv-state-img"></div>
                </div>
              </div>
            </div><!--card-->
          </div>
        </div>
        <div class="btn-area">
          <button id="sv_back" onclick="server(false)">返回</button>
          <button id="sv_refresh" onclick="refreshsv()">刷新</button>
          <button id="copy_svlink">复制链接地址</button>
          <button id="sv_det">详细信息</button>
        </div>
      </section>
      <section id="options-page" class="dirt unselectable" style="display: none;">
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
          <button>按钮1</button>
          <button>按钮2</button>
          <button>按钮3</button>
          <button>按钮4</button>
        </div>
      </section>
    </section>
    <script type="text/javascript" src="mc-background.js"></script>
    <script type="text/javascript" src="playsound.js"></script>
    <script src="page.js"></script>
  </body>
</html>
